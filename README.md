# PriceInsight

## Описание

**PriceInsight** — аналитический сервис для автоматизированного прогнозирования цен на основе анализа исторических данных, объёма продаж, затрат на продвижение и цен конкурентов.  
В проекте используются FastAPI, PostgreSQL, SQLAlchemy, pandas и scikit-learn.

---

## Структура проекта

- `src/etl.py` — загрузка, очистка и запись исходных данных в базу и CSV
- `src/features.py` — генерация фичей (mean_competitor_price), сохранение в CSV и/или БД
- `src/train.py` — обучение ML-модели, расчет метрик, сохранение модели
- `src/api.py` — REST API на FastAPI для онлайн-предсказаний по новым данным
- `src/db.py` — работа с базой данных через SQLAlchemy ORM
- `tests/` — автоматические тесты на pytest (API, обучение и др.)
- `data/` — входные/выходные файлы данных (игнорируются в git)
- `update_pipeline.py` — скрипт для автоматического запуска всего пайплайна
- `.env.example` — шаблон файла с переменными окружения

---

## Запуск проекта

### 1. Клонирование и установка

```bash
git clone https://github.com/YourUsername/PriceInsight.git
cd PriceInsight
python -m venv .venv
.venv\Scripts\activate           # Windows
# или
source .venv/bin/activate       # Linux/Mac
pip install --upgrade pip
pip install -r requirements.txt
````

### 2. Настройка переменных окружения

* Скопируйте `.env.example` в `.env` и укажите свои параметры подключения к БД:

  ```
  DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432/priceinsight
  ```

### 3. Запуск пайплайна (ручной)

```bash
python update_pipeline.py
```

Этот скрипт:

* загружает и обрабатывает данные (`etl.py`)
* генерирует признаки (`features.py`)
* обучает модель (`train.py`)

---

### 4. Автоматизация обновления (по расписанию)

Для регулярного обновления (например, каждый день в 2:00):

```bash
python update_pipeline.py --schedule
```

Можно изменить время автозапуска в коде (по умолчанию каждый день в 02:00).

---

### 5. Запуск REST API

```bash
uvicorn src.api:app --reload
```

* Документация и тесты доступны по адресу: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

---

### 6. Тестирование и покрытие

```bash
pytest                   # запуск всех тестов
coverage run -m pytest   # запуск с покрытием
coverage report          # посмотреть покрытие кода
```

* Минимальное покрытие: 75% (см. отчёт)

---

## Логирование

* Все этапы пайплайна, API-запросы, ошибки и метрики логируются в консоль с датой и подробностями.

---

## Конфиденциальность

* Все секреты (доступы к БД, ключи) хранятся только в `.env` (см. `.env.example`).
* Не храните `.env`, реальные CSV и модели в публичном репозитории — используйте `.gitignore`!

---

## Интеграция с БД

* Все обработанные данные можно сохранить и использовать из PostgreSQL (или другой СУБД), схема описана в `src/db.py`.
* Можно быстро перейти на любую совместимую СУБД, изменив только строку подключения.

---

## Автоматизация и поддержка

* Пайплайн можно запускать вручную, по расписанию через встроенный Python-планировщик или стандартные cron/Task Scheduler.
* Все этапы легко масштабируются, можно дорабатывать pipeline и API под нужды бизнеса.

---

